<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Delivery</title>

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" media="all" href="/css/table.css" th:href="@{/css/table.css}" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            color: #fff;
            font-family: 'Roboto', sans-serif;
        }
        .table-hover tbody tr:hover {
            background-color: #e0f7fa;
        }
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: #f1f8fa;
        }
        .table-dark thead {
            background-color: #343a40;
            color: #fff;
        }
        .btn-secondary, .btn-primary, .btn-dark-theme {
            color: #fff;
            background-color: #343a40;
            border-color: #343a40;
        }
        .btn-secondary:hover, .btn-primary:hover, .btn-dark-theme:hover {
            background-color: #23272b;
            border-color: #1d2124;
        }
        .form-control, .form-select {
            background-color: #343a40;
            color: #fff;
            border: 1px solid #343a40;
        }
        /* Increase specificity by adding more selectors */
        select.form-control,
        select.form-control option,
        .form-control:focus,
        .form-select:focus {
            background-color: #343a40 !important; /* Use !important to force override */
            color: #fff !important;
            border: 1px solid #343a40 !important;
            box-shadow: none !important;
        }

        /* Ensure option elements inherit the background */
        select.form-control option {
            background-color: #343a40 !important;
            color: #fff !important;
        }
        .header-dark {
            background-color: #343a40;
            color: #fff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: 'Roboto', sans-serif;
            border: 1px solid transparent;
            border-image: linear-gradient(to right, #c0c0c0, #ffffff);
            border-image-slice: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
        }
        .header-small {
            background-color: #343a40;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: 'Roboto', sans-serif;
            border: 1px solid transparent;
            border-image: linear-gradient(to right, #c0c0c0, #ffffff);
            border-image-slice: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: fit-content;
            max-width: 400px;
            margin: 0 auto 15px auto;
            text-align: center;
        }
        .back-button {
            margin-right: 20px;
            font-size: 2rem;
        }
        .back-button a {
            color: #343a40;
            background-color: #fff;
            padding: 10px;
            border-radius: 50%;
            border: 2px solid #343a40;
        }
        .back-button a:hover {
            background-color: #23272b;
            color: #fff;
            border-color: #23272b;
        }
        .alert {
            background-color: #343a40;
            color: #fff;
            border: 1px solid #343a40;
        }
        .alert-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .alert-success {
            background-color: #28a745;
            border-color: #28a745;
        }
        .alert-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-submit-dark {
            font-size: 1.2rem;
            background-color: #444;
            color: #fff;
            padding: 10px 20px;
            border-radius: 5px;
            border: 2px solid #343a40;
            display: inline-block;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.3s ease;
            margin-top: 10px;
            width: 100%;
        }
        .btn-submit-dark:hover {
            background-color: #333;
            border-color: #23272b;
        }
        .btn-dark-custom {
            background-color: #343a40;
            color: #fff;
            border: 1px solid #343a40;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .btn-dark-custom:hover {
            background-color: #1d2124; /* Darker shade on hover */
            color: #f8f9fa; /* Lighter text on hover */
        }
        .pagination .page-link {
            color: #fff;
            background-color: #343a40;
            border: 1px solid #343a40;
        }
        .pagination .page-link:hover {
            background-color: #23272b;
            border-color: #1d2124;
        }
        .pagination .active .page-link {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }
        .required:after {
            content: " *";
            color: red;
        }
        .form-label {
            color: #000;
        }
        .notes-bubble {
            background-color: #f1f8fa;
            border: 1px solid #c0c0c0;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .progress {
            flex: 1;
            margin-left: 20px;
        }
        .progress-bar {
            background-color: #6c757d;
        }
        .price-class {
            color: #000;
        }
        .producttype-name {
            color: #000;
        }
        /* Make the checkbox larger */
        #quantityModeCheckbox {
            width: 25px;
            height: 25px;

        }
        .table-title {
            color: black;
        }
        /* Optional styling to make the table look nice */
        .table-title-popup {
            margin-bottom: 20px;
            color:white;
        }

        /* Style the label: dark background with white text */
        .form-check-label {
            background-color: #343a40; /* Dark background */
            color: white;              /* White text */
            padding: 5px 10px;         /* Add some padding */
            border-radius: 5px;        /* Optional: round the corners */
        }

        /* Optionally, adjust the label's appearance when the checkbox is focused */
        #quantityModeCheckbox:focus + .form-check-label {
            outline: 2px solid white;  /* Add an outline to the label when checkbox is focused */
        }
    </style>

    <style>
        .warning-message {
            color: red;
            display: none; /* Hide by default */
        }
    </style>

    <!-- CSS Styles -->
    <style>
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7); /* Black overlay with transparency */
            z-index: 9999; /* Ensure it appears above other content */
        }

        /* Popup content styling */
        .popup-content {
            background-color: #343a40;
            color: white;
            width: 80%; /* Large portion of the screen */
            max-width: 900px;
            height: 80%;
            padding: 20px;
            margin: auto;
            margin-top: 5%;
            border-radius: 15px;

            /*start what is needed for scrolling*/
            max-width: 80%; /* Set a max width for the popup */
            max-height: 80vh; /* Limit the height of the popup to 80% of the viewport height */
            overflow-y: auto; /* Allow vertical scrolling inside the popup */
            /*end what is needed for scrolling*/


            border: 5px solid black; /* Thick black border */
            box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.8); /* Shadow for hovering effect */
            position: relative;
        }

        /* Close button styling */
        .close-popup {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 2rem;
            color: white;
            cursor: pointer;
        }

        .close-popup:hover {
            color: #ff0000; /* Red on hover */
        }

        /* Blur background when popup is visible */
        body.blur-background {
            filter: blur(8px);
            overflow: hidden; /* Disable scrolling when popup is active */
        }
    </style>


    <script>
        $(document).ready(function () {
            // Function to check the delivery name validity
            function validateDeliveryName() {
                var deliveryName = $('#deliveryname').val().trim();  // Get the trimmed value of the input

                // Show or hide the warning message based on the delivery name length
                if (deliveryName.length < 1) {
                    $('#deliveryNameWarning').show();  // Show the warning message if invalid
                } else {
                    $('#deliveryNameWarning').hide();  // Hide the warning message if valid
                }
            }

            // Call validateDeliveryName on page load
            validateDeliveryName();

            // Attach the validateDeliveryName function to the input event
            $('#deliveryname').on('input', validateDeliveryName);
        });
    </script>

    <script>
        // Function to process barcode scanning
        function processBarcode(scannedValue) {
            if (scannedValue.length >= 11) {

                    console.log(scannedValue );
                    // If not in Quantity Mode, just submit the form
                    $('#barcodeInput').val(scannedValue.substring(0, 11));
                    $('#barcodeForm').submit();

            }
        }
    </script>

    <script>
        $(document).ready(function () {
            // Check if the input with id="deliveryname" has no value
            var deliveryNameInput = $('#deliveryname').val().trim();

            // Only show the popup if the deliveryname input is empty
            if (deliveryNameInput === '') {
                let deliveryName = prompt("Please enter the name of delivery you want to create (samplebox, iowa pallet, john's shipment etc):");

                // If the user provides input, set the value of the #deliveryname input
                if (deliveryName !== null && deliveryName.trim().length > 0) {
                    $('#deliveryname').val(deliveryName.trim());
                    $('#deliveryNameWarning').hide();  // Hide the warning message if valid

                }
            }

            $('#barcodeInput').focus();

            $('#deliverytypeselectid').on('change', function() {
                if ($('#barcodeInput').val().trim() === '') {
                    $('#barcodeInput').focus();
                }
            });

            $('#deliverytypeselectid2').on('change', function() {
                if ($('#barcodeInput').val().trim() === '') {
                    $('#barcodeInput').focus();
                }
            });

            const inputField = document.getElementById('barcodeInput');

            inputField.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    const scannedValue = inputField.value.trim();
                    processBarcode(scannedValue);
                }
            });

            // Add event listener to the checkbox
            $('#quantityModeCheckbox').on('click', function() {
                // Refocus on the barcode input field when the checkbox is clicked
                $('#barcodeInput').focus();
            });




            function focusInputAfterDelay(selector, delay) {
                setTimeout(function() {
                    $(selector).focus();
                }, delay);
            }

            focusInputAfterDelay('#barcodeInput', 100);

            $('#barcodeInput').on('input', function () {
                if ($(this).val().trim() !== '') {
                    $('#submitTransactionForm button').prop('disabled', true);
                } else {
                    $('#submitTransactionForm button').prop('disabled', false);
                }
            });

            const reviewDeliveryButton = $('#submitTransactionForm button');
            const tableRows = $('#barcodeForm tbody tr');
            if (tableRows.length === 0) {
                reviewDeliveryButton.prop('disabled', true);
            } else {
                reviewDeliveryButton.prop('disabled', false);
            }
        });

        function deleteItemFromDelivery(element) {
            event.preventDefault();
            const barcode = element.closest('tr').getAttribute('data-barcode');
            const form = document.getElementById('deleteItemFromDeliveryForm');

            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'barcode';
            hiddenInput.value = barcode;
            console.log(hiddenInput);
            console.log(form);
            form.appendChild(hiddenInput);

            form.submit();
        }

        function hydratePackageBarcodeInput() {
            // Set the value of the barcode input field
            document.getElementById('barcodeInput').value = document.getElementById('packageBarcodeId').textContent;

            // Optional: Refocus on the barcode input field
            document.getElementById('barcodeInput').focus();

            // now call the method that will validate barcode and submit to backend
            processBarcode(document.getElementById('barcodeInput').value);
        }

        function hydrateCrateBarcodeInput() {
            // Set the value of the barcode input field
            document.getElementById('barcodeInput').value = document.getElementById('crateBarcodeId').textContent;

            // Optional: Refocus on the barcode input field
            document.getElementById('barcodeInput').focus();

            // now call the method that will validate barcode and submit to backend
            processBarcode(document.getElementById('barcodeInput').value);
        }
    </script>

    <script>
        function copyToClipboard(buttonElement) {
            // Get the value from the data-barcode attribute
            var barcodeValue = buttonElement.getAttribute('data-barcode');

            // Copy to clipboard (assuming you've already implemented this logic)
            var tempInput = document.createElement('input');
            tempInput.value = barcodeValue;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);

            // Provide feedback (optional)
            alert("Copied: " + barcodeValue);
        }

    </script>

    <!-- JavaScript to handle popup logic -->
    <script>
        $(document).ready(function() {
            // Check if delivery.packageinscope is not null
            // this somehow works with thymeleaf to inject values serverside before this javascript renders
        var packageInScopeExists = [[${delivery.packageinscope != null}]];
        console.log(packageInScopeExists);

            if (packageInScopeExists) {
                showPopup();
            }

            // Show popup
            function showPopup() {
                $('#popupPackageInScopeTable').fadeIn();  // Display the popup
                $('#mainContent').addClass('blur-background');  // Blur the main content only
            }

            // Close popup when 'X' is clicked
            $('.close-popup').on('click', function() {
                $('#popupPackageInScopeTable').fadeOut();  // Hide the popup
                $('#mainContent').removeClass('blur-background');  // Remove blur effect from the main content
            });
        });
    </script>

    <script>
        $(document).ready(function() {
            // Check if delivery.crateinscope is not null
            // this somehow works with thymeleaf to inject values serverside before this javascript renders
        var crateInScopeExists = [[${delivery.crateinscope != null}]];
        console.log(crateInScopeExists);

            if (crateInScopeExists) {
                showPopup();
            }

            // Show popup
            function showPopup() {
                $('#popupCrateInScopeTable').fadeIn();  // Display the popup
                $('#mainContent').addClass('blur-background');  // Blur the main content only
            }

            // Close popup when 'X' is clicked
            $('.close-popup').on('click', function() {
                $('#popupCrateInScopeTable').fadeOut();  // Hide the popup
                $('#mainContent').removeClass('blur-background');  // Remove blur effect from the main content
            });
        });
    </script>


</head>
<body>
<form id="deleteItemFromDeliveryForm" th:action="@{/delivery/deleteitem?deliveryid=__${delivery.deliveryid}__}" th:object="${delivery}" method="post">
    <input type="hidden" name="_method" value="delete" />
</form>
<div th:insert="fragments/palletmodenavbar.html :: palletmodefragment"></div>
<div id="mainContent" class="container">
    <div class="header-dark">
        <div class="back-button">
            <a th:href="@{/dashboard/index}"><i class="bi bi-arrow-left-circle"></i></a>
        </div>
        <div class="col-md-6">
            <h1>Delivery</h1>
            <p>Scan Packages and Crates to add to Delivery</p>
        </div>
        <div class="col-md-6">
            <h3>Total Packages:
                <span th:text="${delivery.displayquantitytotalpackages}"></span>
            </h3>
            <h3>Total Crates:
                <span th:text="${delivery.displayquantitytotalcrates}"></span>
            </h3>
<!--            <h6 th:if="${delivery.deliverybarcode}">Delivery UPCA:-->
<!--                <span th:text="${delivery.deliverybarcode}"></span>-->
<!--                <button type="button" class="btn btn-dark-custom btn-sm"-->
<!--                        onclick="copyToClipboard(this)"-->
<!--                        th:data-barcode="${delivery.deliverybarcode}"-->
<!--                >-->
<!--                    Copy-->
<!--                </button>-->
<!--            </h6>-->

        </div>
    </div>

    <br>

    <div class="alert alert-danger" role="alert" th:if="${errorMessage}" th:text="${errorMessage}">Error</div>
    <div class="alert alert-success" role="alert" th:if="${successMessage}" th:text="${successMessage}">Success</div>

    <!-- Form and Tables Row -->
    <div class="row">
        <!-- Left side: Barcode and Delivery Name Inputs -->
        <div class="col-md-4">
            <form id="barcodeForm" th:action="@{/delivery/scan?deliveryid=__${delivery.deliveryid != null ? delivery.deliveryid : '0'}__}" th:object="${delivery}" method="post">
                        <div style="margin-bottom: 10px;">

                            <input id="barcodeInput" type="text" th:field="*{barcode}" class="form-control" placeholder="barcode" aria-label="barcode">

                        </div>
                        <div style="margin-bottom: 5px;">
                            <input type="hidden" th:field="*{isprocessed}">
<!--                            <input type="hidden" th:field="*{weight}">-->
<!--                            <input type="hidden" th:field="*{deliverybarcode}">-->
                            <input type="hidden" th:field="*{updateTimeStamp}">
                            <input type="hidden" th:field="*{createTimeStamp}">
                        </div>

                        <div style="margin-bottom: 5px;">
                            <label class="form-label required">Delivery Name</label>
                            <input id="deliveryname" type="text" th:field="*{name}" class="form-control" placeholder="name" aria-label="name">
                        </div>
                         <div id="deliveryNameWarning" class="warning-message">Please name the delivery</div>

                         <input type="hidden" th:field="*{package_list}">

                <button style="margin-top: 5px; visibility: hidden;" type="submit" class="btn btn-primary">Submit</button>
            </form>


        </div>

        <!-- top middle Packages in Delivery -->
        <div class="col-md-4">
                <h3 class="text-center table-title">Packages in Delivery</h3>
                <table th:if="${pageOfPackageInDelivery != null}" id="itemTable" class="table table-hover table-striped table-dark">
                    <thead>
                    <tr>
                        <th>UPCA</th>
                        <th>Package Name</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
<!--                    <tr th:each="item : ${delivery.package_list}" th:data-barcode="${item.packagebarcode}">-->
                    <tr th:each="item, iStat : ${pageOfPackageInDelivery.content}"
                        th:style="${iStat.odd}? 'font-weight: bold;'"
                        th:alt-title="${iStat.even}? 'even' : 'odd'"
                        th:data-barcode="${item.packagebarcode}">

                    <!--                        <td th:text="${item.packagebarcode}" data-barcode="${item.packagebarcode}"></td>-->
                        <td>
                            <a th:href="@{/delivery?deliveryid=__${delivery.deliveryid}__&packageid=__${item.packageid}__}"
                               th:text="${item.packagebarcode}"
                               th:id="${'barcode-'+item.packagebarcode}"
                               th:data-barcode="${item.packagebarcode}"
                               class="btn btn-secondary btn-sm">
                            </a>
                            <!-- Button to copy barcode -->
                            <button type="button" class="btn btn-dark-custom btn-sm"
                                    onclick="copyToClipboard(this)"
                                    th:data-barcode="${item.packagebarcode}"
                            >
                                Copy
                            </button>
                        </td>
                        <td th:text="${item.name}" data-barcode="${item.packagebarcode}"></td>
                        <td>
                            <a id="deleteItemID" href="#" onclick="deleteItemFromDelivery(this)">
                                <i class="fs-4 bi bi-x text-danger float-end"></i>
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <nav th:if="${pageOfPackageInDelivery != null && pageOfPackageInDelivery.totalPages > 0}">
                    <ul class="pagination justify-content-center">
                        <li class="page-item" th:each="pageNumber : ${deliverypageNumbers}">
                            <a class="page-link btn btn-secondary btn-sm mx-1"
                               th:href="@{/delivery?deliverysize=__${deliverysize}__&deliverypage=__${pageNumber == 1 ? 0 : pageNumber - 1}__&deliveryid=__${delivery.deliveryid}__}"
                               th:text="${pageNumber}"
                               th:classappend="${pageNumber==pageOfPackageInDelivery.number + 1} ? 'active'">
                            </a>
                        </li>
                    </ul>
                </nav>
        </div>

        <!-- Crates in Delivery display upper right -->
        <div class="col-md-4">
            <h3 class="text-center table-title">Crates in Delivery</h3>
            <table th:if="${pageOfCrateInDelivery != null}" id="crateTable" class="table table-hover table-striped table-dark">
                <thead>
                <tr>
                    <th>UPCA</th>
                    <th>Crate Name</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                <!--                    <tr th:each="item : ${delivery.crate_list}" th:data-barcode="${item.cratebarcode}">-->
                <tr th:each="item, iStat : ${pageOfCrateInDelivery.content}"
                    th:style="${iStat.odd}? 'font-weight: bold;'"
                    th:alt-title="${iStat.even}? 'even' : 'odd'"
                    th:data-barcode="${item.cratebarcode}">

                    <!--                        <td th:text="${item.cratebarcode}" data-barcode="${item.cratebarcode}"></td>-->
                    <td>
                        <a th:href="@{/delivery?deliveryid=__${delivery.deliveryid}__&crateid=__${item.crateid}__}"
                           th:text="${item.cratebarcode}"
                           th:id="${'barcode-'+item.cratebarcode}"
                           th:data-barcode="${item.cratebarcode}"
                           class="btn btn-secondary btn-sm">
                        </a>
                        <!-- Button to copy barcode -->
                        <button type="button" class="btn btn-dark-custom btn-sm"
                                onclick="copyToClipboard(this)"
                                th:data-barcode="${item.cratebarcode}"
                        >
                            Copy
                        </button>
                    </td>
                    <td th:text="${item.name}" data-barcode="${item.cratebarcode}"></td>
                    <td>
                        <a id="deleteItemID" href="#" onclick="deleteItemFromDelivery(this)">
                            <i class="fs-4 bi bi-x text-danger float-end"></i>
                        </a>
                    </td>
                </tr>
                </tbody>
            </table>
            <nav th:if="${pageOfCrateInDelivery != null && pageOfCrateInDelivery.totalPages > 0}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:each="pageNumber : ${deliverypageNumbers}">
                        <a class="page-link btn btn-secondary btn-sm mx-1"
                           th:href="@{/delivery?deliverysize=__${deliverysize}__&deliverypage=__${pageNumber == 1 ? 0 : pageNumber - 1}__&deliveryid=__${delivery.deliveryid}__}"
                           th:text="${pageNumber}"
                           th:classappend="${pageNumber==pageOfCrateInDelivery.number + 1} ? 'active'">
                        </a>
                    </li>
                </ul>
            </nav>
        </div>


    <!-- Table that shows the packages available to add -->
    <div class="row mt-4"> <!-- Added margin top for spacing -->
        <div class="col-md-6"> <!-- Spanning across half the width (6 out of 12) -->
            <h3 class="text-center table-title">Packages Not Processed</h3>
            <table class="table table-hover table-striped table-dark">
                <thead>
                <tr>
                    <th scope="col">UPCA</th>
                    <th scope="col">Package Name</th>
                </thead>
                <tbody>
                <tr th:each="package, iStat : ${packagePage.content}"
                    th:style="${iStat.odd}? 'font-weight: bold;'"
                    th:alt-title="${iStat.even}? 'even' : 'odd'">
                    <td>
                        <a th:href="@{/delivery?deliveryid=__${delivery.deliveryid}__&packageid=__${package.packageid}__}"
                           th:text="${package.packagebarcode}"
                           th:data-barcode="${package.packagebarcode}"
                           class="btn btn-secondary btn-sm">
                        </a>
                        <!-- Button to copy barcode -->
                        <button type="button" class="btn btn-dark-custom btn-sm"
                                onclick="copyToClipboard(this)"
                                th:data-barcode="${package.packagebarcode}"
                        >
                            Copy
                        </button>
                    </td>
                    <td th:text="${package.name}"></td>
                </tr>
                </tbody>
            </table>
            <nav th:if="${packagePage.totalPages > 0}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:each="pageNumber : ${pageNumbers}">
                        <a class="page-link btn btn-secondary btn-sm mx-1"
                           th:href="@{/delivery?size=__${size}__&page=__${pageNumber == 1 ? 0 : pageNumber - 1}__&deliveryid=__${delivery.deliveryid}__}"
                           th:text="${pageNumber}"
                           th:classappend="${pageNumber==packagePage.number + 1} ? 'active'">
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="col-md-6"> <!-- Spanning across half the width (6 out of 12) -->
            <h3 class="text-center table-title">Crates Not Processed</h3>
            <table class="table table-hover table-striped table-dark">
                <thead>
                <tr>
                    <th scope="col">UPCA</th>
                    <th scope="col">Crate Name</th>
                </thead>
                <tbody>
                <tr th:each="crate, iStat : ${cratePage.content}"
                    th:style="${iStat.odd}? 'font-weight: bold;'"
                    th:alt-title="${iStat.even}? 'even' : 'odd'">
                    <td>
                        <a th:href="@{/delivery?deliveryid=__${delivery.deliveryid}__&crateid=__${crate.crateid}__}"
                           th:text="${crate.cratebarcode}"
                           th:data-barcode="${crate.cratebarcode}"
                           class="btn btn-secondary btn-sm">
                        </a>
                        <!-- Button to copy barcode -->
                        <button type="button" class="btn btn-dark-custom btn-sm"
                                onclick="copyToClipboard(this)"
                                th:data-barcode="${crate.cratebarcode}"
                        >
                            Copy
                        </button>
                    </td>
                    <td th:text="${crate.name}"></td>
                </tr>
                </tbody>
            </table>
            <nav th:if="${cratePage.totalPages > 0}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:each="pageNumber : ${pageNumbers}">
                        <a class="page-link btn btn-secondary btn-sm mx-1"
                           th:href="@{/delivery?size=__${size}__&page=__${pageNumber == 1 ? 0 : pageNumber - 1}__&deliveryid=__${delivery.deliveryid}__}"
                           th:text="${pageNumber}"
                           th:classappend="${pageNumber==cratePage.number + 1} ? 'active'">
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>


    <!-- Popup Table -->
    <div th:if="${delivery.packageinscope}" id="popupPackageInScopeTable" class="popup-overlay">
        <div class="popup-content">
            <button class="close-popup">
                <i class="bi bi-x-lg"></i>
            </button>
            <h3 class="text-center table-title-popup"><span th:text="${delivery.packageinscope.name}"></span> | UPCA:
                <span id="packageBarcodeId" th:text="${delivery.packageinscope.packagebarcode}"></span></h3>
            <table id="packageInScopeTable" class="table table-hover table-striped table-dark">
                <thead>
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${delivery.packageinscope.product_package_list}" th:data-barcode="${item.barcode}">
                    <td th:text="${item.name}" data-barcode="${item.barcode}">Item Name</td>
                    <td th:text="${item.displayquantity}" >Item Name</td>
                </tr>
                </tbody>
            </table>
            <button th:if="${delivery.packageinscope.delivery == null}" type="button" class="btn-submit-dark" onclick="hydratePackageBarcodeInput()">Add To Delivery</button>
            <a th:href="@{/package?packageid=__${delivery.packageinscope.packageid}__&deliveryid=__${delivery.deliveryid}__}"
               class="btn-submit-dark">Modify Package</a>
        </div>
    </div>
    <!-- Popup Table -->
    <div th:if="${delivery.crateinscope}" id="popupCrateInScopeTable" class="popup-overlay">
        <div class="popup-content">
            <button class="close-popup">
                <i class="bi bi-x-lg"></i>
            </button>
            <h3 class="text-center table-title-popup"><span th:text="${delivery.crateinscope.name}"></span> | UPCA:
                <span id="crateBarcodeId" th:text="${delivery.crateinscope.cratebarcode}"></span></h3>
            <table id="crateInScopeTable" class="table table-hover table-striped table-dark">
                <thead>
                <tr>
                    <th>Package List Inside Crate</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${delivery.crateinscope.package_list}" th:data-barcode="${item.barcode}">
                    <td th:data-barcode="${item.barcode}">
                        <!-- Display item name -->
                        <div th:text="${item.name}">Item Name</div>

                        <!-- Iterate over the product_package_list and display name and displayquantity -->
                        <ul>
                            <li th:each="productPackage : ${item.product_package_list}">
                                <span th:text="${productPackage.name}"></span> -
                                <span th:text="${productPackage.displayquantity}"></span>
                            </li>
                        </ul>
                    </td>
                </tr>

                </tbody>
            </table>
            <button th:if="${delivery.crateinscope.delivery == null}" type="button" class="btn-submit-dark" onclick="hydrateCrateBarcodeInput()">Add To Delivery</button>
            <a th:href="@{/crate?crateid=__${delivery.crateinscope.crateid}__&deliveryid=__${delivery.deliveryid}__}"
               class="btn-submit-dark">Modify Crate</a>
        </div>
    </div>
</div>



</body>

</html>
