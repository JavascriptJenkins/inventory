<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Delivery Queue</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Include jQuery and Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <!-- CSS Theme Selection based on UIMODE -->
    <link rel="stylesheet" type="text/css" media="all" href="/css/MODERN/modern.css" th:if="${UIMODE != 'RETRO'}" />
    <link rel="stylesheet" type="text/css" media="all" href="/css/RETRO/retro.css" th:if="${UIMODE == 'RETRO'}" />
    <link rel="stylesheet" type="text/css" media="all" href="/css/VEGAS/vegas.css" th:if="${UIMODE == 'VEGAS'}" />

    <!-- Inline styles removed - using CSS theme files -->
    <!-- Pagination styles moved to VEGAS CSS theme -->
    <!-- All remaining inline styles removed - using CSS theme files -->




</head>
<body>

<div th:insert="auth/navbar.html :: navbarfragment"> </div>

<input type="hidden" th:data-current-pagination-page="${page}" th:value="${page}" id="currentPageId">
<input type="hidden" th:data-current-pagination-size="${size}" th:value="${size}" id="currentSizeId">

<div class="container-fluid">

    <div class="header-dark">
        <div class="back-button">
            <a th:href="@{/dashboard/index}"><i class="bi bi-arrow-left-circle"></i></a>
        </div>
        <div>
            <h1>Delivery Queue</h1>
            <p>Review all delivery orders and their status.</p>
        </div>
        <div></div>
    </div>
    <br>
    <form th:action="@{/delivery/queue}" method="get" id="filterForm">

        <!-- Preserve page value on submit -->
        <input type="hidden" name="page" th:value="${page}"/>

        <!-- Dropdown for selecting record size -->
        <div class="record-selector">
            <label for="recordSize">Display Records:</label>
            <select name="size" id="recordSize" class="form-select" onchange="document.getElementById('filterForm').submit()">
                <option value="5" th:selected="${size == 5}">5 Records</option>
                <option value="10" th:selected="${size == 10}">10 Records</option>
                <option value="20" th:selected="${size == 20}">20 Records</option>
                <option value="100" th:selected="${size == 100}">100 Records</option>
                <option value="1000" th:selected="${size == 1000}">1000 Records</option>
            </select>
        </div>

        <!-- Customer Filter -->
        <div class="record-selector">
            <label for="customerselectid">Filter by Customer:</label>
            <select name="customerid" id="customerselectid" class="form-select" onchange="document.getElementById('filterForm').submit()">
                <option value="0" th:selected="${customerid == 0}">All Customers</option>
                <option th:each="customer : ${customers}" th:value="${customer.customerid}" th:text="${customer.name}" th:selected="${customer.customerid == customerid}"></option>
            </select>
        </div>

    </form>

    <!-- Table Content -->
    <div class="table-responsive">
        <table class="table table-hover table-striped table-dark">
            <thead>
            <tr>
                <th scope="col">Delivery ID</th>
                <th scope="col">Customer Name</th>
                <th scope="col">Order Name</th>
                <th scope="col">Status</th>
            </tr>
            </thead>
            <tbody id="tableBody">
        <tr class="delivery-row"  th:each="delivery : ${deliveryPage.content}">
            <td th:text="${delivery.deliveryid}"></td>
            <td th:text="${delivery.transaction.customervo.name}"></td>
            <td th:text="${delivery.name}"></td>
            <td>
                <div class="status-icon-container" th:switch="${delivery.status}">
                    <!-- Dynamic anchor tag wrapping the icon -->
                    <a th:case="0"
                       class="status-icon status-created pulsing-status-0"
                       th:href="@{/delivery/item(deliveryid=${delivery.deliveryid}, menuid=${delivery.transaction.cart.menu.menuid}, deliverytoken=${deliverytoken}, customerid=${customerid}, size=${size}, page=${page})}">
                        CREATED
                    </a>

                    <a th:case="1"
                       class="status-icon status-prep pulsing-status-1"
                       th:href="@{/delivery/item(deliveryid=${delivery.deliveryid}, menuid=${delivery.transaction.cart.menu.menuid}, deliverytoken=${deliverytoken}, customerid=${customerid}, size=${size}, page=${page})}">
                        PREP
                    </a>
                    <a th:case="2"
                       class="status-icon status-dispatch pulsing-status-2"
                       th:href="@{/delivery/item(deliveryid=${delivery.deliveryid}, menuid=${delivery.transaction.cart.menu.menuid}, deliverytoken=${deliverytoken}, customerid=${customerid}, size=${size}, page=${page})}">
                        DISPATCH
                    </a>
                    <a th:case="3"
                       class="status-icon status-enroute pulsing-status-3"
                       th:href="@{/delivery/item(deliveryid=${delivery.deliveryid}, menuid=${delivery.transaction.cart.menu.menuid}, deliverytoken=${deliverytoken}, customerid=${customerid}, size=${size}, page=${page})}">
                        EN ROUTE
                    </a>
                    <a th:case="4"
                       class="status-icon status-complete"
                       th:href="@{/delivery/item(deliveryid=${delivery.deliveryid}, menuid=${delivery.transaction.cart.menu.menuid}, deliverytoken=${deliverytoken}, customerid=${customerid}, size=${size}, page=${page})}">
                        COMPLETE
                    </a>
                    <a th:case="5"
                       class="status-icon status-canceled"
                       th:href="@{/delivery/item(deliveryid=${delivery.deliveryid}, menuid=${delivery.transaction.cart.menu.menuid}, deliverytoken=${deliverytoken}, customerid=${customerid}, size=${size}, page=${page})}">
                        CANCELED
                    </a>
                </div>
            </td>




        </tr>
        </tbody>
    </table>
    </div>

    <!-- Pagination Navigation -->
    <nav th:if="${deliveryPage.totalPages > 0}">
        <ul class="pagination flex-wrap justify-content-center">
            <li class="page-item" th:each="pageNumber : ${pageNumbers}">
                <a class="page-link m-1"
                   th:href="@{/delivery/queue(size=${size}, page=${pageNumber == 1 ? 0 : pageNumber - 1}, customerid=${customerid})}"
                   th:text="${pageNumber}"
                   th:classappend="${pageNumber == deliveryPage.number + 1} ? ' active'">
                </a>
            </li>
        </ul>
    </nav>

</div>
<!-- JavaScript removed - now using form submission for filtering -->

<!-- All JavaScript removed - using form submission for filtering -->



</body>
</html>
