<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Video Player</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- GameBoy-ish heading font -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

    <style>
        :root { --accent: #f25e5a; }

        /* Dark theme base */
        body {
          background-color: #121212;
          color: #e0e0e0;
        }

        .container { max-width: 1100px; }

        /* Header */
        .page-title {
          font-family: 'Press Start 2P', cursive;
          color: var(--accent);
          text-align: center;
          font-size: 1.75rem;
          text-shadow: 2px 2px 0 #000;
          margin: 2.5rem 0 1.75rem 0;
          animation: titlePulse 2s infinite ease-in-out;
        }
        @keyframes titlePulse {
          0% { transform: scale(1); }
          50% { transform: scale(1.06); }
          100% { transform: scale(1); }
        }

        /* Back button styled like the menu */
        .back-button {
          display: inline-flex;
          align-items: center;
          gap: .5rem;
          color: #fff !important;
          text-decoration: none;
          background: rgba(242, 94, 90, 0.15);
          border: 1px solid rgba(242, 94, 90, 0.6);
          padding: .7rem 1.1rem;
          border-radius: 12px;
          box-shadow: 0 0 15px rgba(242, 94, 90, 0.6);
          transition: transform .2s ease, box-shadow .2s ease, background-color .2s ease;
          animation: backPulse 1.8s ease-in-out infinite;
        }
        .back-button:hover { transform: scale(1.06); box-shadow: 0 0 26px rgba(242, 94, 90, 1); }
        .back-button i { font-size: 1.25rem; }
        @keyframes backPulse {
          0% { box-shadow: 0 0 12px rgba(242, 94, 90, 0.5); }
          50% { box-shadow: 0 0 24px rgba(242, 94, 90, 1); }
          100% { box-shadow: 0 0 12px rgba(242, 94, 90, 0.5); }
        }

        /* Table */
        .table-wrap { background-color: #1e1e1e; border: 1px solid #333; border-radius: 16px; overflow: hidden; }
        table.table { margin: 0; color: #fff; }
        thead th {
          background-color: #262626;
          color: #fff;
          border-bottom: 1px solid #333;
          font-weight: 600;
        }
        tbody tr { transition: background-color .2s ease, transform .15s ease; }
        tbody tr:hover { background-color: #242424; transform: scale(1.01); }
        .table > :not(caption) > * > * { border-color: #333; }

        /* Video preview cell */
        .video-cell {
          display: flex; align-items: center; gap: .75rem;
        }
        .video-card {
          background: #161616; border: 1px solid #333; border-radius: 14px; padding: .5rem;
          box-shadow: 0 0 10px rgba(255,255,255,0.05);
        }
        video {
          display: block; width: 320px; height: 200px; object-fit: cover; border-radius: 10px;
          border: 4px solid #676767;
        }

        /* Alerts in dark theme */
        .alert-primary { background-color: #1f2937; color: #fff; border: 1px solid #374151; }
        .alert-warning { background-color: #3a2f18; color: #fff; border: 1px solid #5c4a22; }

        /* Pagination */
        .pagination .page-link {
          background-color: #1f1f1f; color: #fff; border-color: #444;
        }
        .pagination .page-link:hover { background-color: #333; }
        .pagination .page-link.active, .pagination .active > .page-link {
          background-color: rgba(242, 94, 90, 0.85);
          border-color: var(--accent);
          color: #fff;
          box-shadow: 0 0 10px rgba(242, 94, 90, 0.7);
        }

        /* Scroll-to-top like menu page */
        #scrollTopBtn {
          position: fixed; bottom: 30px; right: 30px; z-index: 9999; display: none;
          background-color: rgba(242, 94, 90, 0.9) !important; color: #fff; border: none; border-radius: 50%;
          padding: 24px; font-size: 3.5rem; cursor: pointer;
          box-shadow: 0 0 18px rgba(242, 94, 90, 0.7);
          animation: scrollPulse 1.6s ease-in-out infinite;
          transition: transform .2s ease, box-shadow .2s ease, font-size .2s ease, padding .2s ease;
        }
        #scrollTopBtn:hover { transform: scale(1.15); box-shadow: 0 0 30px rgba(242, 94, 90, 1); }
        @keyframes scrollPulse {
          0% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5); }
          50% { box-shadow: 0 0 35px rgba(242, 94, 90, 1); }
          100% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5); }
        }
        @keyframes scrollPulseFast {
          0% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5); }
          50% { box-shadow: 0 0 40px rgba(242, 94, 90, 1); }
          100% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5); }
        }
        #scrollTopBtn.fast-pulse { font-size: 4rem; padding: 28px; animation: scrollPulseFast .8s ease-in-out infinite; }
    </style>
</head>
<body>
<div class="container mt-4">
    <!-- Back Button -->
    <div class="mb-3">
        <a th:href="@{/menu2/shop(menuid=${menuid}, shoppingtoken=${shoppingtoken})}" class="back-button">
            <i class="bi bi-arrow-left"></i>
            Back to Menu
        </a>
    </div>

    <div class="page-title">Product Videos</div>

    <div th:if="${filePage != null}">
        <div th:if="${filePage.totalElements > 0}">

            <div class="table-wrap">
                <table class="table table-hover table-striped">
                    <thead>
                    <tr>
                        <th scope="col">File Name</th>
                        <th scope="col">Directory</th>
                        <th scope="col">Preview</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="file : ${filePage.content}">
                        <td th:text="${file.filename}"></td>
                        <td th:text="${file.directory}"></td>
                        <td>
                            <div class="video-cell">
                                <div class="video-card">
                                    <video controls>
                                        <source th:src="@{/video/videos/{productid}/{filename}(productid=${productid}, filename=${file.filename})}" type="video/mp4" />
                                        Your browser does not support the video tag.
                                    </video>
                                </div>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div th:if="${filePage.totalElements == 0}">
            <div class="alert alert-warning" role="alert">No files uploaded yet.</div>
        </div>
    </div>

    <nav th:if="${filePage != null && filePage.totalPages > 0}" class="mt-4">
        <ul class="pagination justify-content-center">
            <li class="page-item" th:each="pageNumber : ${filePage.totalPages}">
                <a class="page-link mx-1"
                   th:href="@{/files?page=__${pageNumber - 1}__&size=5}"
                   th:text="${pageNumber}"
                   th:classappend="${pageNumber == filePage.number + 1} ? 'active'">
                </a>
            </li>
        </ul>
    </nav>
</div>

<!-- Scroll-to-top button -->
<button onclick="window.scrollTo({ top: 0, behavior: 'smooth' });" id="scrollTopBtn" title="Back to top">
    <i class="bi bi-arrow-up-circle-fill"></i>
</button>

<script>
    // Show/hide scroll top button & fast pulse threshold based on viewport height
    (function () {
      const btn = document.getElementById('scrollTopBtn');
      function threshold() { return Math.round(window.innerHeight * 2.5); }
      let fast = threshold();

      window.addEventListener('resize', () => fast = threshold());
      window.addEventListener('scroll', () => {
        if (window.scrollY > 100) btn.style.display = 'block'; else btn.style.display = 'none';
        if (window.scrollY > fast) btn.classList.add('fast-pulse'); else btn.classList.remove('fast-pulse');
      });
    })();
</script>
</body>
</html>
