<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Photo Player - Card Grid</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />

    <style>
        :root { --accent: #f25e5a; }
        body { background-color: #121212; color: #e0e0e0; }
        .container { max-width: 1300px; }

        .page-title {
          font-family: 'Press Start 2P', cursive;
          color: var(--accent);
          text-align: center;
          font-size: 1.75rem;
          text-shadow: 2px 2px 0 #000;
          margin: 2.5rem 0 1.75rem 0;
          animation: titlePulse 2s infinite ease-in-out;
        }
        @keyframes titlePulse { 0% { transform: scale(1);} 50% { transform: scale(1.06);} 100% { transform: scale(1);} }

        .back-button {
          display: inline-flex; align-items: center; gap: .5rem;
          color: #fff !important; text-decoration: none;
          background: rgba(242, 94, 90, 0.15);
          border: 1px solid rgba(242, 94, 90, 0.6);
          padding: .7rem 1.1rem; border-radius: 12px;
          box-shadow: 0 0 15px rgba(242, 94, 90, 0.6);
          animation: backPulse 1.8s ease-in-out infinite;
        }
        .back-button:hover { transform: scale(1.06); box-shadow: 0 0 26px rgba(242, 94, 90, 1); }
        @keyframes backPulse { 0% { box-shadow: 0 0 12px rgba(242, 94, 90, 0.5);} 50% { box-shadow: 0 0 24px rgba(242, 94, 90, 1);} 100% { box-shadow: 0 0 12px rgba(242, 94, 90, 0.5);} }

        .photo-card {
          background: #1e1e1e; border: 1px solid #333; border-radius: 14px; overflow: hidden;
          box-shadow: 0 0 10px rgba(255,255,255,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .photo-card:hover { transform: scale(1.03); box-shadow: 0 0 20px rgba(242, 94, 90, 0.6); }
        .photo-thumb {
          width: 100%; height: 250px; object-fit: cover; border-bottom: 1px solid #333; cursor: zoom-in;
        }
        .photo-card-body { padding: 1rem; }
        .enlarge-btn { background: rgba(242, 94, 90, 0.2); color: #fff; border: 1px solid rgba(242, 94, 90, .6); }
        .enlarge-btn:hover { background: rgba(242, 94, 90, 0.35); }

        .popup-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .popup-content { position: relative; background: #1a1a1a; padding: 16px; border-radius: 14px; max-width: 92%; max-height: 92%; box-shadow: 0 0 24px rgba(242, 94, 90, 0.45); }
        .popup-close { position: absolute; top: 10px; right: 10px; font-size: 24px; font-weight: bold; color: #fff; cursor: pointer; background: rgba(242, 94, 90, 0.15); border: 1px solid rgba(242, 94, 90, .6); border-radius: 50%; width: 36px; height: 36px; display: grid; place-items: center; }
        .popup-img { max-width: 100%; max-height: 78vh; border-radius: 10px; border: 4px solid #676767; }

        #scrollTopBtn { position: fixed; bottom: 30px; right: 30px; z-index: 9999; display: none; background-color: rgba(242, 94, 90, 0.9) !important; color: #fff; border: none; border-radius: 50%; padding: 24px; font-size: 3.5rem; cursor: pointer; box-shadow: 0 0 18px rgba(242, 94, 90, 0.7); animation: scrollPulse 1.6s ease-in-out infinite; }
        #scrollTopBtn:hover { transform: scale(1.15); box-shadow: 0 0 30px rgba(242, 94, 90, 1); }
        @keyframes scrollPulse { 0% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5);} 50% { box-shadow: 0 0 35px rgba(242, 94, 90, 1);} 100% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5);} }
        @keyframes scrollPulseFast { 0% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5);} 50% { box-shadow: 0 0 40px rgba(242, 94, 90, 1);} 100% { box-shadow: 0 0 15px rgba(242, 94, 90, 0.5);} }
        #scrollTopBtn.fast-pulse { font-size: 4rem; padding: 28px; animation: scrollPulseFast .8s ease-in-out infinite; }
    </style>
</head>
<body>
<div class="container mt-4">
    <div class="mb-3">
        <a th:href="@{/menu2/shop(menuid=${menuid}, shoppingtoken=${shoppingtoken})}" class="back-button">
            <i class="bi bi-arrow-left"></i>
            Back to Menu
        </a>
    </div>
    <div class="page-title">Product Photos</div>

    <div th:if="${filePage != null}">
        <div th:if="${filePage.totalElements > 0}" class="row g-4">
            <div class="col-md-4" th:each="file : ${filePage.content}">
                <div class="photo-card">
                    <img class="photo-thumb" loading="lazy" th:src="@{/photo/photos/{productid}/{filename}(productid=${productid}, filename=${file.filename})}" alt="Photo" onclick="showPhotoPopup(this)"/>
                    <div class="photo-card-body">
                        <h6 th:text="${file.filename}" class="text-truncate"></h6>
                        <small th:text="${file.directory}"></small>
                        <div class="mt-2">
                            <button class="btn enlarge-btn w-100" onclick="showPhotoPopup(this)" th:data-photo-url="@{/photo/photos/{productid}/{filename}(productid=${productid}, filename=${file.filename})}">
                                <i class="bi bi-arrows-fullscreen me-1"></i> Enlarge Photo
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${filePage.totalElements == 0}" class="alert alert-warning mt-3">No files uploaded yet.</div>
    </div>
</div>

<div id="photoPopupOverlay" class="popup-overlay">
    <div class="popup-content">
        <div class="popup-close" onclick="closePhotoPopup()">&times;</div>
        <img id="popupPhotoDisplay" class="popup-img" src="" alt="Enlarged Photo" />
    </div>
</div>

<button onclick="window.scrollTo({ top: 0, behavior: 'smooth' });" id="scrollTopBtn" title="Back to top">
    <i class="bi bi-arrow-up-circle-fill"></i>
</button>

<script>
    function showPhotoPopup(el) {
      const url = el.getAttribute('data-photo-url') || el.getAttribute('src');
      document.getElementById('popupPhotoDisplay').src = url;
      document.getElementById('photoPopupOverlay').style.display = 'flex';
    }
    function closePhotoPopup() {
      document.getElementById('photoPopupOverlay').style.display = 'none';
      document.getElementById('popupPhotoDisplay').src = '';
    }
    (function () {
      const btn = document.getElementById('scrollTopBtn');
      function threshold() { return Math.round(window.innerHeight * 2.5); }
      let fast = threshold();
      window.addEventListener('resize', () => fast = threshold());
      window.addEventListener('scroll', () => {
        if (window.scrollY > 100) btn.style.display = 'block'; else btn.style.display = 'none';
        if (window.scrollY > fast) btn.classList.add('fast-pulse'); else btn.classList.remove('fast-pulse');
      });
    })();
</script>
</body>
</html>
